# N2pcBiophysicalModeling
 Biophysical Modeling of the Columnar/Laminar Origin of the N2pc.

Main analysis code for figures in Herrera and Westerberg et al. 2021.

## Dependencies
- MATLAB (released 2021b, [The MathWorks](https://www.mathworks.com/?s_tid=gn_logo)). Toolboxes: Signal Processing Toolbox.
- NEURON simulator (http://www.neuron.yale.edu/neuron)
- LFPy 2.2 (https://github.com/LFPy/LFPy)
- [CSDplotter-master](https://github.com/espenhgn/CSDplotter)
- [Brainstorm](https://neuroimage.usc.edu/brainstorm/Introduction)
- Elephant (https://elephant.readthedocs.io/en/latest/)
- Neo (https://neo.readthedocs.io/en/latest/)

## Description
- [brainstorm_N2pc_db](brainstorm_N2pc_db): NMTv2 atlas [(Jung et al. 2021)](https://doi.org/10.1016/j.neuroimage.2021.117997) anatomy folder in Brainstorm format. 
- [sim_L5PCsPop](sim_L5PCsPop): Biophysical simulations performed for Figure 2. 
- [sim_V4data](sim_V4data): Lead fields and dipoles' location used in the manuscript (...) to estimate the contribution of V4, LIP, 7A and FEF to the N2pc, calculated for NMTv2 atlas and monkey Y head models.
   * [compCSD_splineiCSDmethod.m](compCSD_splineiCSDmethod.m): code to estimate the current source density (CSD) from the local field potentials (LFPs) using the cubic spline iCSD method from [Pettersen et al. 2006, *Journal of neuroscience methods*, 154(1-2), 116-133](https://www.sciencedirect.com/science/article/pii/S0165027005004541). Dependencies: [CSDplotter-master](https://github.com/beaherrera/2-compartments_L5-PC_model/tree/master/Toolbox).
  * [compDipEEGfromCSD.m](compDipEEGfromCSD.m): code to estimate the EEG generated by two dipoles (one in each hemisphere) located in the brain of a macaque monkey, whose current dipole moments are calculated from the CSD patterns evoked by the LFPs recorded intracranially with a linear probe. This function will output the current dipole moments estimated from the CSD and the EEG evoked by their combine activation. Both data sets will be saved in a .mat file in the folder designated by you.

## Analysis steps
1. (Optional) Run [compCSD_splineiCSDmethod.m](compCSD_splineiCSDmethod.m) first if you do not have the CSD data or wish to use the cubic spline iCSD method.
2. Run [compDipEEGfromCSD.m](compDipEEGfromCSD.m) to estimate the current dipole moments and the EEG generated by them.

## License
Copyright (C) 2021- Beatriz Herrera, Jacob A. Westerberg, Michelle S. Schall, Alexander Maier, Geoffrey F. Woodman, Jorge J. Riera, and Jeffrey D. Schall.

This program is free software: you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version.

This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details.

[GNU GPLv3](https://choosealicense.com/licenses/gpl-3.0/)

## Citation

